<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MiTV - TV Remote</title>
<!-- Versi√≥n estable de Hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12"></script>
<style>
  :root { --ui: rgba(0,0,0,.55); --fg:#fff; --accent:#e50914; }
  html,body{margin:0;height:100%;background:#000}
  #screen{position:fixed;inset:0;background:#000}
  video, #ytFrame{
    position:absolute;inset:0;width:100%;height:100%;border:0;
    display:none;background:#000
  }
  #bar{
    position:fixed;left:0;right:0;top:0;display:flex;gap:.5rem;flex-wrap:wrap;
    align-items:center;padding:.6rem;background:var(--ui);color:var(--fg);
    transform:translateY(0);transition:.25s;backdrop-filter:blur(6px);z-index:10
  }
  #bar.hide{ transform:translateY(-110%); }
  #bar button{
    background:#111;border:1px solid #333;color:#fff;padding:.6rem .8rem;
    border-radius:.6rem;cursor:pointer;font:600 16px system-ui,-apple-system,Segoe UI,Arial
  }
  #bar button.active{ background:var(--accent); border-color:#b30610; }
  #overlay{
    position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.85);
    color:#fff;font:600 20px/1.4 system-ui,-apple-system,Segoe UI,Arial;text-align:center;padding:24px;z-index:9
  }
  #overlay.show{display:grid}
  .hint{opacity:.9;max-width:760px}
</style>
</head>
<body>

<!-- Barra de canales -->
<div id="bar" aria-hidden="true">
  <button id="btnCronica" data-hls="720p">Cr√≥nica 720p</button>
  <button id="btnA24" data-yt="https://www.youtube.com/embed/ArKbAx1K-2U?autoplay=1&mute=1&playsinline=1&rel=0&modestbranding=1&enablejsapi=1">A24 (YouTube)</button>
  <button id="btnSound"> Sonido </button>
</div>

<!-- Pantalla √∫nica -->
<div id="screen">
  <video id="v" autoplay playsinline muted></video>
  <iframe id="ytFrame"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          referrerpolicy="strict-origin-when-cross-origin"></iframe>
</div>

<!-- Overlay de ayuda -->
<div id="overlay" class="show">
  <div class="hint">
    Toc√° <b>üîä </b> o <b>Enter/OK</b> para activar <b>audio</b> y <b>pantalla completa</b>.<br/>
    Volumen: <b>Arriba/Abajo</b>. Salir FS: <b>Back/Escape</b>.
  </div>
</div>

<script>
(function(){
  const v  = document.getElementById('v');
  const yt = document.getElementById('ytFrame');
  const bar = document.getElementById('bar');
  const overlay = document.getElementById('overlay');
  const btnCronica = document.getElementById('btnCronica');
  const btnA24 = document.getElementById('btnA24');
  const btnSound = document.getElementById('btnSound');

  // Fuentes Cr√≥nica
  const CRONICA = {
    '720p': "https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_720p.m3u8",
    '480p': "https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_480p.m3u8",
  };
  let cronicaQuality = '720p';  // alterna 720p <-> 480p

  let mode = 'hls'; // 'hls' | 'yt'
  let hls;

  function showBar(){
    bar.classList.remove('hide');
    clearTimeout(showBar.t);
    showBar.t = setTimeout(()=>bar.classList.add('hide'), 4000);
  }

  async function requestFS(){
    const el=document.documentElement;
    if(!document.fullscreenElement){
      if(el.requestFullscreen) await el.requestFullscreen();
      else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
    }
  }

  function setActive(btn){
    document.querySelectorAll('#bar button').forEach(b=>b.classList.remove('active'));
    if (btn) btn.classList.add('active');
  }

  function stopHLS(){
    try{ if (hls) { hls.destroy(); hls = null; } }catch(e){}
    v.pause(); v.removeAttribute('src'); v.load();
  }

  function stopYT(){
    try{ yt.contentWindow?.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*'); }catch(e){}
    yt.src = 'about:blank';
  }

  function playHLS(src, btn){
    mode = 'hls';
    setActive(btn);
    stopYT();
    yt.style.display = 'none';
    v.style.display = 'block';
    stopHLS();

    if (window.Hls && Hls.isSupported()){
      hls = new Hls({ lowLatencyMode:true });
      hls.attachMedia(v);
      hls.on(Hls.Events.MEDIA_ATTACHED, () => { hls.loadSource(src); });
      hls.on(Hls.Events.MANIFEST_PARSED, async () => {
        try {
          v.muted = true;          // autoplay permitido
          await v.play();
          overlay.classList.remove('show');
        } catch(e){}
      });
      hls.on(Hls.Events.ERROR, (evt, data)=>{
        if (data?.fatal){
          overlay.innerHTML = '<div class="hint">Error cargando Cr√≥nica. Prob√° cambiar de calidad tocando "Cr√≥nica".</div>';
          overlay.classList.add('show');
        }
      });
    } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
      v.src = src;
      (async ()=>{ try{ v.muted=true; await v.play(); overlay.classList.remove('show'); }catch(e){} })();
    } else {
      overlay.innerHTML = '<div class="hint">Tu navegador no soporta HLS.</div>';
      overlay.classList.add('show');
    }
  }

  function playYT(url, btn){
    mode = 'yt';
    setActive(btn);
    stopHLS();
    v.style.display = 'none';
    yt.style.display = 'block';
    yt.src = url; // autoplay mute por URL
    setTimeout(()=>{
      try{ yt.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*'); }catch(e){}
    }, 600);
  }

  // ‚Äî‚Äî‚Äî Botones ‚Äî‚Äî‚Äî
  btnCronica.addEventListener('click', ()=>{
    // Alterna calidad cada toque
    cronicaQuality = (cronicaQuality === '720p') ? '480p' : '720p';
    btnCronica.textContent = `Cr√≥nica ${cronicaQuality}`;
    playHLS(CRONICA[cronicaQuality], btnCronica);
  });

  btnA24.addEventListener('click', ()=>{
    playYT(btnA24.getAttribute('data-yt'), btnA24);
  });

  // Bot√≥n de SONIDO / FULLSCREEN (destraba audio en todos)
  btnSound.addEventListener('click', async ()=>{
    await requestFS();
    if (mode === 'hls'){
      try{ v.muted=false; v.volume=Math.max(0.3, v.volume||1); }catch(e){}
      try{ await v.play(); }catch(e){}
    } else {
      try{
        yt.contentWindow?.postMessage('{"event":"command","func":"unMute","args":""}', '*');
        yt.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
      }catch(e){}
    }
    overlay.classList.remove('show');
  });

  // Teclado / control remoto
  document.addEventListener('keydown', async (e)=>{
    showBar();
    const k = e.key || e.code;

    // Enter/OK = mismo que bot√≥n de sonido
    if (k==='Enter' || k==='NumpadEnter') {
      e.preventDefault();
      btnSound.click();
      return;
    }

    // Volumen (solo HLS)
    if (k==='ArrowUp' || k==='ArrowDown'){
      e.preventDefault();
      if (mode==='hls'){
        const delta = (k==='ArrowUp') ? +0.05 : -0.05;
        v.volume = Math.max(0, Math.min(1, (v.volume||0)+delta));
      }
    }

    // Salir FS
    if (k==='Escape' || k==='Backspace'){
      if (document.fullscreenElement && document.exitFullscreen) document.exitFullscreen();
    }
  });

  // Primer toque en pantalla tambi√©n destraba
  document.addEventListener('pointerdown', async ()=>{
    if (overlay.classList.contains('show')) {
      btnSound.click();
    }
  });

  // Arranque: Cr√≥nica 720p
  playHLS(CRONICA[cronicaQuality], btnCronica);
  showBar();
})();
</script>
</body>
</html>
