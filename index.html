<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MiTV - TV Remote</title>
<!-- Versión estable de Hls.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.12"></script>
<style>
  :root { --ui: rgba(0,0,0,.55); --fg:#fff; --accent:#e50914; }
  html,body{margin:0;height:100%;background:#000}
  #screen{position:fixed;inset:0;background:#000}
  video, #ytFrame{
    position:absolute;inset:0;width:100%;height:100%;border:0;
    display:none;background:#000
  }
  #bar{
    position:fixed;left:0;right:0;top:0;display:flex;gap:.5rem;flex-wrap:wrap;
    align-items:center;padding:.6rem;background:var(--ui);color:var(--fg);
    transform:translateY(0);transition:.25s;backdrop-filter:blur(6px);z-index:10
  }
  #bar.hide{ transform:translateY(-110%); }
  #bar button{
    background:#111;border:1px solid #333;color:#fff;padding:.6rem .8rem;
    border-radius:.6rem;cursor:pointer;font:600 16px system-ui,-apple-system,Segoe UI,Arial
  }
  #bar button.active{ background:var(--accent); border-color:#b30610; }
  #overlay{
    position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.85);
    color:#fff;font:600 20px/1.4 system-ui,-apple-system,Segoe UI,Arial;text-align:center;padding:24px;z-index:9
  }
  #overlay.show{display:grid}
  .hint{opacity:.9;max-width:760px}
</style>
</head>
<body>

<!-- Barra de canales -->
<div id="bar" aria-hidden="true">
  <button data-hls="https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_720p.m3u8">Crónica 720p</button>
  <button data-hls="https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_480p.m3u8">Crónica 480p</button>
  <button data-yt="https://www.youtube.com/embed/ArKbAx1K-2U?autoplay=1&mute=1&playsinline=1&rel=0&modestbranding=1&enablejsapi=1">A24 (YouTube)</button>
</div>

<!-- Pantalla única -->
<div id="screen">
  <video id="v" autoplay playsinline muted></video>
  <iframe id="ytFrame"
          allow="autoplay; fullscreen; picture-in-picture"
          allowfullscreen
          referrerpolicy="strict-origin-when-cross-origin"></iframe>
</div>

<!-- Overlay de ayuda -->
<div id="overlay" class="show">
  <div class="hint">
    Pulsá <b>OK/Enter</b> para activar <b>sonido</b> y <b>pantalla completa</b>.<br/>
    Volumen: <b>Arriba/Abajo</b>.  Play/Pause: tecla del control.  Salir FS: <b>Back/Escape</b>.
  </div>
</div>

<script>
(function(){
  const v = document.getElementById('v');
  const yt = document.getElementById('ytFrame');
  const overlay = document.getElementById('overlay');
  const bar = document.getElementById('bar');
  let mode = 'hls';
  let hls;

  const DEFAULT_SRC = "https://g3.vxral-hor.transport.edge-access.net/a09/ngrp:cronicatv_video1-100044_all/cronicatv_video1-100044_720p.m3u8";
  const qs = new URL(location.href).searchParams;
  const SRC = qs.get('src') || DEFAULT_SRC;

  function showBar(){
    bar.classList.remove('hide');
    clearTimeout(showBar.t);
    showBar.t = setTimeout(()=>bar.classList.add('hide'), 4000);
  }

  async function requestFS(){
    const el=document.documentElement;
    if(!document.fullscreenElement){
      if(el.requestFullscreen) await el.requestFullscreen();
      else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
    }
  }

  function setActive(btn){
    document.querySelectorAll('#bar button').forEach(b=>b.classList.remove('active'));
    if (btn) btn.classList.add('active');
  }

  function stopHLS(){
    try{ if (hls) { hls.destroy(); hls = null; } }catch(e){}
    v.pause(); v.removeAttribute('src'); v.load();
  }

  function stopYT(){
    try{ yt.contentWindow?.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*'); }catch(e){}
    yt.src = 'about:blank';
  }

  function playHLS(src, btn){
    mode = 'hls';
    setActive(btn);
    stopYT();
    yt.style.display = 'none';
    v.style.display = 'block';
    stopHLS();

    if (window.Hls && Hls.isSupported()){
      hls = new Hls({ lowLatencyMode:true });
      hls.attachMedia(v);
      hls.on(Hls.Events.MEDIA_ATTACHED, () => {
        hls.loadSource(src);
      });
      hls.on(Hls.Events.MANIFEST_PARSED, async () => {
        try {
          v.muted = true;
          await v.play();
          overlay.classList.remove('show');
        } catch(e){}
      });
    } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
      v.src = src;
      (async ()=>{ try{ v.muted=true; await v.play(); overlay.classList.remove('show'); }catch(e){} })();
    } else {
      overlay.innerHTML = '<div class="hint">Tu navegador no soporta HLS.</div>';
      overlay.classList.add('show');
    }
  }

  function playYT(url, btn){
    mode = 'yt';
    setActive(btn);
    stopHLS();
    v.style.display = 'none';
    yt.style.display = 'block';
    yt.src = url;
    setTimeout(()=>{
      try{ yt.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*'); }catch(e){}
    }, 600);
  }

  document.querySelectorAll('#bar button').forEach(btn=>{
    const h = btn.getAttribute('data-hls');
    const y = btn.getAttribute('data-yt');
    if (h) btn.addEventListener('click', ()=> playHLS(h, btn));
    if (y) btn.addEventListener('click', ()=> playYT(y, btn));
  });

  document.addEventListener('keydown', async (e)=>{
    showBar();
    const k = e.key || e.code;
    if (k==='Enter' || k==='NumpadEnter') {
      e.preventDefault(); await requestFS();
      if (mode==='hls'){
        try{ v.muted=false; v.volume=Math.max(0.3,v.volume||1); }catch(e){}
        try{ await v.play(); }catch(e){}
      } else {
        try{
          yt.contentWindow?.postMessage('{"event":"command","func":"unMute","args":""}', '*');
          yt.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        }catch(e){}
      }
      overlay.classList.remove('show');
    }
    if (k==='ArrowUp' || k==='ArrowDown'){
      e.preventDefault();
      if (mode==='hls'){
        const delta = (k==='ArrowUp') ? +0.05 : -0.05;
        v.volume = Math.max(0, Math.min(1, (v.volume||0)+delta));
      }
    }
    if (k==='Escape' || k==='Backspace'){
      if (document.fullscreenElement && document.exitFullscreen) document.exitFullscreen();
    }
  });

  document.addEventListener('pointerdown', async ()=>{
    if (overlay.classList.contains('show')) {
      await requestFS();
      if (mode==='hls'){
        try{ v.muted=false; v.volume=Math.max(0.3, v.volume||1); }catch(e){}
        try{ await v.play(); }catch(e){}
      } else {
        try{
          yt.contentWindow?.postMessage('{"event":"command","func":"unMute","args":""}', '*');
          yt.contentWindow?.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        }catch(e){}
      }
      overlay.classList.remove('show');
    }
  });

  // Arranque en Crónica
  playHLS(SRC, document.querySelector(`#bar button[data-hls="${SRC}"]`));
  showBar();
})();
</script>
</body>
</html>
